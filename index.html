<!DOCTYPE html>
<html>
<head>
    <title>Chat App</title>


    <!-- This should set up the tab icon -->
    <![if !IE]>
    <link rel="icon" href="imgs/favicon.ico" type="image/x-icon" />
    <![endif]>
    <link rel="shortcut icon" href="imgs/favicon.ico" type="image/ico" />
	
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<!--<base href="http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com/">-->
	<!-- sources -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	 <!-- JavaScript files -->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	
    <!-- CSS stylesheets -->
	<link rel="stylesheet" href="css/stylesheet.css" />
    <link rel="stylesheet" href="css/index_stylesheet.css" />

    <!-- Scripts -->
	<script src="js/socket.io.js" type="text/javascript"></script>
	<script src="http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com:80/socket.io/socket.io.js"></script>
	<script src="js/chat.js"type="text/javascript"></script>

</head>

<body>
    <div id="nav_bar">
        <h1 id="title"> My Christian Chat </h1>
        <div id="nav_btn">
            <a id="create_button" class="nav_button" name="button1"  href="newuser.html">Create Account</a>
            <a id="login_button" class="nav_button" name="button1" href="login.html">Login</a>

            <!--TODO: Get this button working to go back to rooms page -->
            <a id="back_button" class="nav_button">Back</a>
        </div>
    </div>

    <!--Boot strap -->
	<div class = "container">
			<div class = "row">
					<div class = "col-md-4">
			</div>
			<div class = "col-md-8">
				<div>
					<h3 id="name"> Conversation Name </h3>
					<ul  class="list-group" id="user"></ul>
				</div>
				<div id="chat_container" class = "col-md-8">
					<div class = "chat" id ="chat"></div>
					<form id = "messageForm">
						<div class = "form-group">
						  <textarea class="form-control" id="message"></textarea>
						  <input id="send_button" type="submit" class = "btn btn-primary" value = "Send Message" />
						</div>
					</form>
				</div>
			</div>
		</div>
		
		    <!--Client using socket.io -->
			<script>
				$(function(){
					var socket = io.connect('http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com:8080');
					var $messageForm = $('#messageForm');
					var $message     = $('#message');
					var $chat 		 = $('#chat');
                    var colorChange = false;
					
					 <!--send  -->
					$messageForm.submit(function(e){
						e.preventDefault();
						socket.emit('send message', 'User: ' + $message.val());
						$message.val('');

                        //Used to change colors if you sent message
                        colorChange = true;
					});
					 <!--recieve -->
					socket.on('new message', function(data){
                        if(colorChange){
                            $chat.append('<div class= "sent">'+ data.msg+ '</div>' );
                            $chat.scrollTop($chat.prop("scrollHeight")); //scroll to bottom of chat
                        }
                        else{
				            $chat.append('<div class= "well">'+ data.msg+ '</div>' );
                        }

                        colorChange = false;
					});
				});				
			</script>

            <!-- Script for images -->
            <script type="text/javascript">
			document.addEventListener("DOMContentLoaded", function(){
			 console.log("Dom Loaded");
				// Initialize instances:
				//var socket = io.connect();
				var socket = io.connect('http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com:8080');
				var siofu = new SocketIOFileUpload(socket);

				// Configure the three ways that SocketIOFileUpload can read files:
				document.getElementById("upload_btn").addEventListener("click", siofu.prompt, false);
				siofu.listenOnInput(document.getElementById("upload_input"));
				siofu.listenOnDrop(document.getElementById("file_drop"));

				// Do something on upload progress:
				siofu.addEventListener("progress", function(event){
					var percent = event.bytesLoaded / event.file.size * 100;
					console.log("File is", percent.toFixed(2), "percent loaded");
				});

				// Do something when a file is uploaded:
				siofu.addEventListener("complete", function(event){
					console.log("Upload Work"+ event.success);
					//console.log(event.file);  											// show file contents
					//document.getElementById('imgid').src = 'data:image/jpeg' + event.file; // show file old way
					//window.navigator.msSaveOrOpenBlob(event.file, 'File.jpg'); 			// download file
				});


				///// Recieve photos
				socket.on('img', function(data){
					console.log("Recieved File img style buddy");
					var $chat 		 = $('#chat');
					console.log(data);
					/////////////////////////////////
					// THIS IS WHAT ADDS THE PHOTOS
					/////////////////////////////////
					$chat.append('<div class= "well"><img id="imgid" img src=data:image/jpeg;base64,' +  data + ' alt="image to display" /></div>');
				});
				socket.on('image', function(data){
					console.log("Recieved File");
					console.log(data);
				});


			}, false);
			</script>
					
	
	</div>

        
    <!-- JavaScript files -->
    <script type="text/javascript" src="js/index_page.js"></script>
		
</body>

</html>
