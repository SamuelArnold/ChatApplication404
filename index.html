<!DOCTYPE html>
<html>
<head>
    <title>Chat App</title>


    <!-- This should set up the tab icon -->

   <!--  <link rel="icon" href="imgs/favicon.ico" type="image/x-icon" />-->

   <!--  <link rel="shortcut icon" href="imgs/favicon.ico" type="image/ico" />-->
	
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<base href="http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com/">
	
	<!-- sources -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	
	<!-- JavaScript files -->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	
    <!-- CSS stylesheets -->
	<link rel="stylesheet" href="css/stylesheet.css" />
    <link rel="stylesheet" href="css/index_stylesheet.css" />

    <!-- Scripts -->
	<script src="js/socket.io.js" type="text/javascript"></script>
	<script src="js/socket.io-stream.js" type="text/javascript"></script>
	<script src="/siofu/client.js"></script>

	
</head>

<body>
    <div id="top_bar">
        <h1 id="title"> My Christain Chat </h1>
    </div>

    <!--Boot strap -->
	<div class = "container">
			<div class = "row">
					<div class = "col-md-4">
			</div>
			<div class = "col-md-8">
				<div class = "well">
					<h3> Online Username </h3>
					<ul  class="list-group" id="user"></ul>
				</div>
				<div class = "col-md-8">
					<div class = "chat" id ="chat"></div>
					<form id = "messageForm">
						<div class = "form-group">
						<br/>
						<label> Enter Message </label>
						<br/>
						<textarea class = "form-control" id = "message"></textarea>
						<br/>
						<input type = "submit" class = "btn btn-primary" value = "Send Message" />
						</div>
					</form>
				</div>
			</div>
		</div>
	
			
		    <!--Client using socket.io -->
			
		<p><button id="upload_btn">Prompt for File</button></p>
		<p><label>Choose File: <input type="file" id="upload_input"/></label></p>
		<div id="file_drop" dropzone="copy" title="drop files for upload">Drop File</div>
		
			<script type="text/javascript">
			document.addEventListener("DOMContentLoaded", function(){
			 console.log("Dom Loaded");
			 		var socket = io.connect('http://ec2-18-216-64-197.us-east-2.compute.amazonaws.com:8080');
					var $messageForm = $('#messageForm');
					var $message     = $('#message');
					var $chat 		 = $('#chat');
					var siofu = new SocketIOFileUpload(socket);
					// <!--send  -->
					$messageForm.submit(function(e){
						e.preventDefault();
						socket.emit('send message', 'User: ' + $message.val());
						$message.val('');
						console.log("Form Submitted ");
					});
					
					// <!--recieve --> 
					socket.on('new message', function(data){
						$chat.append('<div class= "well">'+ data.msg+ '</div>' );
							console.log("New Message ");
					});
					// recieve online members
					socket.on('numOnline', function(data){
						$chat.append('<div class= "well">'+'System: Current Number Of Users: ' + data.msg+ '</div>' );
							console.log(" # of onloine users"+ data.msg);
					});
				
					socket.on('file', function(data){  
						console.log("Recieved File");
						document.getElementById('imgid').src = 'data:image/jpeg;base64,' + data;
					});    
			 
				
			 
				// Configure the three ways that SocketIOFileUpload can read files: 
				document.getElementById("upload_btn").addEventListener("click", siofu.prompt, false);
				siofu.listenOnInput(document.getElementById("upload_input"));
				siofu.listenOnDrop(document.getElementById("file_drop"));
			 
				// Do something on upload progress: 
				siofu.addEventListener("progress", function(event){
					var percent = event.bytesLoaded / event.file.size * 100;
					console.log("File is", percent.toFixed(2), "percent loaded");
				});
			 
				// Do something when a file is uploaded: 
				siofu.addEventListener("complete", function(event){
					console.log("Upload Work"+ event.success);
					//console.log(event.file);  											// show file contents
					//document.getElementById('imgid').src = 'data:image/jpeg' + event.file; // show file old way
					//window.navigator.msSaveOrOpenBlob(event.file, 'File.jpg'); 			// download file 
				});
				
				
				///// Recieve photos 
				socket.on('img', function(data){   
					console.log("Recieved File img style buddy");
					//console.log(data);
					/////////////////////////////////
					// THIS IS WHAT ADDS THE PHOTOS 
					/////////////////////////////////
					$chat.append('<div class= "well"><img id="imgid" img src=data:image/jpeg;base64,' +  data + ' alt="image to display" /></div>');
				});    
			
			 
			}, false);
			</script> 
		  
	</div>
    
    <!-- Not sure where you want this but I'm putting the link to account creation here for the moment --> 
        <input type="button" name="button1" value="Create Account" onClick="location.href='newuser.html'">

        <input type="button" name="button1" value="Login" onClick="location.href='login.html'">
        
    <!-- JavaScript files -->

		
</body>

</html>
